\documentclass[]{scrartcl}


\usepackage{amsmath}
\usepackage{cleveref}
\usepackage{comment}
\usepackage{minted}  
\usepackage{xcolor}

\title{Implementation of GDL direct solvers}


\newcommand{\pth}[1]{\left(#1\right)}


\begin{document}

\maketitle

\begin{abstract}
No abstract.
\end{abstract}

\section{Cramers Rule}
\subsection{Theory}
\subsubsection{4x4 Matrices}
\begin{align*}
\begin{bmatrix}
a_0&b_0&c_0&d_0\\
a_1&b_1&c_1&d_1\\
a_2&b_2&c_2&d_2\\
a_3&b_3&c_3&d_3
\end{bmatrix}
\end{align*}

\begin{comment}

\begin{align*}
  a_1b_2c_3d_4 
+ a_1b_3c_4d_2 
+ a_1b_4c_2d_3 
- a_1b_4c_3d_2
- a_1b_2c_4d_3\\
- a_1b_3c_2d_4
- a_2b_1c_3d_4
- a_4b_1c_2d_3
- a_3b_1c_4d_2
+ a_4b_1c_3d_2\\
+ a_2b_1c_4d_3
+ a_3b_1c_2d_4
+ a_2b_3c_1d_4
+ a_4b_2c_1d_3
+ a_3b_4c_1d_2\\
- a_4b_3c_1d_2
- a_2b_4c_1d_3
- a_3b_2c_1d_4
- a_2b_3c_4d_1
- a_4b_2c_3d_1\\
- a_3b_4c_2d_1
+ a_4b_3c_2d_1
+ a_2b_4c_3d_1
+ a_3b_2c_4d_1           
\end{align*}

\end{comment}


\begin{align*}
a_0b_1c_2d_3 
+ a_0b_2c_3d_1 
+ a_0b_3c_1d_2
- a_0b_1c_3d_2
- a_0b_2c_1d_3 
- a_0b_3c_2d_1\\
+ a_1b_0c_3d_2
+ a_1b_2c_0d_3
+ a_1b_3c_2d_0
- a_1b_0c_2d_3
- a_1b_2c_3d_0
- a_1b_3c_0d_2\\
+ a_2b_0c_1d_3
+ a_2b_1c_3d_0
+ a_2b_3c_0d_1
- a_2b_0c_3d_1
- a_2b_1c_0d_3
- a_2b_3c_1d_0\\
+ a_3b_0c_2d_1
+ a_3b_1c_0d_2
+ a_3b_2c_1d_0
- a_3b_0c_1d_2
- a_3b_1c_2d_0
- a_3b_2c_0d_1           
\end{align*}


\subsection{Implementation}

\subsubsection{4x4 Determinant - SSE}
\label{sec:determinant4x4SSE}

\begin{align*}
  a_0b_1 \pth{c_2d_3 - c_3d_2} 
+ a_0b_2 \pth{c_3d_1 - c_1d_3}
+ a_0b_3 \pth{c_1d_2 - c_2d_1}\\
+ a_1b_0 \pth{c_3d_2 - c_2d_3}
+ a_1b_2 \pth{c_0d_3 - c_3d_0}
+ a_1b_3 \pth{c_2d_0 - c_0d_2}\\
+ a_2b_0 \pth{c_1d_3 - c_3d_1}
+ a_2b_1 \pth{c_3d_0 - c_0d_3}
+ a_2b_3 \pth{c_0d_1 - c_1d_0}\\
+ a_3b_0 \pth{c_2d_1 - c_1d_2}
+ a_3b_1 \pth{c_0d_2 - c_2d_0}
+ a_3b_2 \pth{c_1d_0 - c_0d_1}
\end{align*}


\begin{align*}
  \pth{a_0b_1 - a_1b_0} \pth{c_2d_3 - c_3d_2}\\
+ \pth{a_0b_2 - a_2b_0} \pth{c_3d_1 - c_1d_3}\\
+ \pth{a_0b_3 - a_3b_0} \pth{c_1d_2 - c_2d_1}\\
+ \pth{a_1b_2 - a_2b_1} \pth{c_0d_3 - c_3d_0}\\
+ \pth{a_1b_3 - a_3b_1} \pth{c_2d_0 - c_0d_2}\\
+ \pth{a_2b_3 - a_3b_2} \pth{c_0d_1 - c_1d_0}\\
\end{align*}

\begin{align*}
  \pth{a_0b_1 - a_1b_0} \pth{c_2d_3 - c_3d_2}\\
+ \pth{a_1b_2 - a_2b_1} \pth{c_0d_3 - c_3d_0}\\
+ \pth{a_2b_3 - a_3b_2} \pth{c_0d_1 - c_1d_0}\\
+ \pth{a_3b_0 - a_0b_3} \pth{c_2d_1 - c_1d_2}\\
+ \pth{a_0b_2 - a_2b_0} \pth{c_3d_1 - c_1d_3}\\
+ \pth{a_1b_3 - a_3b_1} \pth{c_2d_0 - c_0d_2}\\
\end{align*}

Matrix as 4 \mintinline{cpp}{__m128} registers:

\begin{align*}
\mathrm{col0} 
=
\begin{bmatrix}
a_0\\
a_1\\
a_2\\
a_3\\
\end{bmatrix}
&&
\mathrm{col1} 
&=
\begin{bmatrix}
b_0\\
b_1\\
b_2\\
b_3\\
\end{bmatrix}
&
\mathrm{col2} 
=
\begin{bmatrix}
c_0\\
c_1\\
c_2\\
c_3\\
\end{bmatrix}
&&
\mathrm{col3} 
&=
\begin{bmatrix}
d_0\\
d_1\\
d_2\\
d_3\\
\end{bmatrix}
\end{align*}



\vspace{1cm}
\textbf{Calculation of the first 4 products}
\vspace{1cm}

\begin{minted}{cpp}
__m128 col0P1230 = Permute<1, 2, 3, 0>(col0);
__m128 col1P1230 = Permute<1, 2, 3, 0>(col1);
__m128 col2P1230 = Permute<1, 2, 3, 0>(col2);
__m128 col3P1230 = Permute<1, 2, 3, 0>(col3);

\end{minted}

\begin{align*}
\mathrm{col0} 
=
\begin{bmatrix}
a_1\\
a_2\\
a_3\\
a_0\\
\end{bmatrix}
&&
\mathrm{col1} 
&=
\begin{bmatrix}
b_1\\
b_2\\
b_3\\
b_0\\
\end{bmatrix}
&
\mathrm{col2} 
=
\begin{bmatrix}
c_1\\
c_2\\
c_3\\
c_0\\
\end{bmatrix}
&&
\mathrm{col3} 
&=
\begin{bmatrix}
d_1\\
d_2\\
d_3\\
d_0\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 tmp0 = _mmx_fmsub_p(col0, col1P1230, _mm_mul_ps(col0P1230, col1));
__m128 tmp1 = _mmx_fmsub_p(col2, col3P1230, _mm_mul_ps(col2P1230, col3));
\end{minted}


\begin{align*}
\mathrm{tmp0} 
=
\begin{bmatrix}
a_0b_1 - a_1b_0\\
a_1b_2 - a_2b_1\\
a_2b_3 - a_3b_2\\
a_3b_0 - a_0b_3\\
\end{bmatrix}
&&
\mathrm{tmp1} 
&=
\begin{bmatrix}
c_0d_1 - c_1d_0\\
c_1d_2 - c_2d_1\\
c_2d_3 - c_3d_2\\
c_3d_0 - c_0d_3\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 tmp1P2301 = Permute<2, 3, 0, 1>(tmp1);
\end{minted}

\begin{align*}
\mathrm{tmp1P2301} 
=
\begin{bmatrix}
c_2d_3 - c_3d_2\\
c_3d_0 - c_0d_3\\
c_0d_1 - c_1d_0\\
c_1d_2 - c_2d_1\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
 __m128 tmp1P2301N = Negate<0, 1, 0, 1>(tmp1P2301);
\end{minted}

\begin{align*}
\mathrm{tmp1P2301N} 
=
\begin{bmatrix}
c_2d_3 - c_3d_2\\
c_0d_3 - c_3d_0\\
c_0d_1 - c_1d_0\\
c_2d_1 - c_1d_2\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 prodSum03 = DotProduct(tmp0, tmp1P2301N);
\end{minted}

\begin{align*}
\mathrm{prodSum03} 
&=
\begin{bmatrix}
\mathrm{dot03}\\
\mathrm{dot03}\\
\mathrm{dot03}\\
\mathrm{dot03}\\
\end{bmatrix}\\
\\
\mathrm{dot03}
&= \pth{a_0b_1 - a_1b_0} \pth{c_2d_3 - c_3d_2}\\
&+ \pth{a_1b_2 - a_2b_1} \pth{c_0d_3 - c_3d_0}\\
&+ \pth{a_2b_3 - a_3b_2} \pth{c_0d_1 - c_1d_0}\\
&+ \pth{a_3b_0 - a_0b_3} \pth{c_2d_1 - c_1d_2}\\
\end{align*}


\vspace{1cm}
\textbf{Calculation of the last 2 products}
\vspace{1cm}

\begin{minted}{cpp}
__m128 b0 = Blend<0, 0, 1, 1>(col0, col2);
__m128 b1 = Blend<1, 1, 0, 0>(col0, col2);
__m128 b2 = Blend<0, 0, 1, 1>(col1, col3);
__m128 b3 = Blend<1, 1, 0, 0>(col1, col3);
\end{minted}

\begin{align*}
\mathrm{b0} 
=
\begin{bmatrix}
a_0\\
a_1\\
c_2\\
c_3\\
\end{bmatrix}
&&
\mathrm{b1} 
&=
\begin{bmatrix}
c_0\\
c_1\\
a_2\\
a_3\\
\end{bmatrix}
&
\mathrm{b2} 
=
\begin{bmatrix}
b_0\\
b_1\\
d_2\\
d_3\\
\end{bmatrix}
&&
\mathrm{b3} 
&=
\begin{bmatrix}
d_0\\
d_1\\
b_2\\
b_3\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 b1P2301 = Permute<2, 3, 0, 1>(b1);
__m128 b3P2301 = Permute<2, 3, 0, 1>(b3);
\end{minted}

\begin{align*}
\mathrm{b1P2301} 
=
\begin{bmatrix}
a_2\\
a_3\\
c_0\\
c_1\\
\end{bmatrix}
&&
\mathrm{b3P2301} 
&=
\begin{bmatrix}
b_2\\
b_3\\
d_0\\
d_1\\
\end{bmatrix}
\end{align*}


\begin{minted}{cpp}
__m128 tmp4 = _mmx_fmsub_p(b0, b3P2301, _mm_mul_ps(b1P2301, b2));
\end{minted}

\begin{align*}
\mathrm{tmp4} 
=
\begin{bmatrix}
a_0b_2 - a_2b_0\\
a_1b_3 - a_3b_1\\
c_2d_0 - c_0d_2\\
c_3d_1 - c_1d_3\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 tmp4P3210 = Permute<3, 2, 1, 0>(tmp4);
\end{minted}

\begin{align*}
\mathrm{tmp4P3210} 
=
\begin{bmatrix}
c_3d_1 - c_1d_3\\
c_2d_0 - c_0d_2\\
a_1b_3 - a_3b_1\\
a_0b_2 - a_2b_0\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
    __m128 tmp5 = _mm_mul_ps(tmp4, tmp4P3210);
\end{minted}

\begin{align*}
\mathrm{tmp5} 
=
\begin{bmatrix}
\pth{a_0b_2 - a_2b_0}\pth{c_3d_1 - c_1d_3}\\
\pth{a_1b_3 - a_3b_1}\pth{c_2d_0 - c_0d_2}\\
\pth{a_1b_3 - a_3b_1}\pth{c_2d_0 - c_0d_2}\\
\pth{a_0b_2 - a_2b_0}\pth{c_3d_1 - c_1d_3}\\
\end{bmatrix}
\end{align*}


\begin{minted}{cpp}
__m128 prodSum45 = _mm_add_ps(tmp5, Permute<1, 0, 3, 2>(tmp5));
\end{minted}



\begin{align*}
\mathrm{prodSum45} 
=
\begin{bmatrix}
  \pth{a_0b_2 - a_2b_0}\pth{c_3d_1 - c_1d_3}
+ \pth{a_1b_3 - a_3b_1}\pth{c_2d_0 - c_0d_2}\\
  \pth{a_0b_2 - a_2b_0}\pth{c_3d_1 - c_1d_3}
+ \pth{a_1b_3 - a_3b_1}\pth{c_2d_0 - c_0d_2}\\
  \pth{a_0b_2 - a_2b_0}\pth{c_3d_1 - c_1d_3}
+ \pth{a_1b_3 - a_3b_1}\pth{c_2d_0 - c_0d_2}\\
  \pth{a_0b_2 - a_2b_0}\pth{c_3d_1 - c_1d_3}
+ \pth{a_1b_3 - a_3b_1}\pth{c_2d_0 - c_0d_2}\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
return _mm_cvtss_f32(prodSum03) + _mm_cvtss_f32(prodSum45);
\end{minted}


\subsubsection{4x4 Solver - SSE}

The first part of the solver implementation is identical to the calculation of the determinant as described in \cref{sec:determinant4x4SSE}. The return statement is replaced by a check if the system is solvable.

\begin{minted}{cpp}
DEV_EXCEPTION(_mm_cvtss_f32(prodSum03) + _mm_cvtss_f32(prodSum45) 
               == ApproxZero<F32>(10), "Singular matrix - system not solveable");
\end{minted} 

The values of the right-hand side vector are stored in a single \mintinline{cpp}{__m128} register with name \mintinline{cpp}{v}. Additionally, a permutation of \mintinline{cpp}{v} is created as follows:

\begin{minted}{cpp}
__m128 vP1230 = Permute<1, 2, 3, 0>(v);
\end{minted}


\begin{align*}
\mathrm{v} 
=
\begin{bmatrix}
v_0\\
v_1\\
v_2\\
v_3\\
\end{bmatrix}
&&
\mathrm{vP1230} 
&=
\begin{bmatrix}
v_1\\
v_2\\
v_3\\
v_0\\
\end{bmatrix}
\end{align*}


\begin{minted}{cpp}
__m128 tmp0V0 = _mmx_fmsub_p(v, col1P1230, _mm_mul_ps(vP1230, col1));
__m128 tmp0V1 = _mmx_fmsub_p(col0, vP1230, _mm_mul_ps(col0P1230, v));
__m128 tmp1V2 = _mmx_fmsub_p(v, col3P1230, _mm_mul_ps(vP1230, col3));
__m128 tmp1V3 = _mmx_fmsub_p(col2, vP1230, _mm_mul_ps(col2P1230, v));
\end{minted}

\begin{align*}
\mathrm{tmp0V0} 
=
\begin{bmatrix}
v_0b_1 - v_1b_0\\
v_1b_2 - v_2b_1\\
v_2b_3 - v_3b_2\\
v_3b_0 - v_0b_3\\
\end{bmatrix}
&&
\mathrm{tmp0V1} 
&=
\begin{bmatrix}
a_0v_1 - a_1v_0\\
a_1v_2 - a_2v_1\\
a_2v_3 - a_3v_2\\
a_3v_0 - a_0v_3\\
\end{bmatrix}
&
\mathrm{tmp1V2} 
=
\begin{bmatrix}
v_0d_1 - v_1d_0\\
v_1d_2 - v_2d_1\\
v_2d_3 - v_3d_2\\
v_3d_0 - v_0d_3\\
\end{bmatrix}
&&
\mathrm{tmp1V3} 
&=
\begin{bmatrix}
c_0v_1 - c_1v_0\\
c_1v_2 - c_2v_1\\
c_2v_3 - c_3v_2\\
c_3v_0 - c_0v_3\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 tmp1V2P2301 = Permute<2, 3, 0, 1>(tmp1V2);
__m128 tmp1V3P2301 = Permute<2, 3, 0, 1>(tmp1V3);
\end{minted}

\begin{align*}
\mathrm{tmp1V2P2301} 
=
\begin{bmatrix}
v_2d_3 - v_3d_2\\
v_3d_0 - v_0d_3\\
v_0d_1 - v_1d_0\\
v_1d_2 - v_2d_1\\
\end{bmatrix}
&&
\mathrm{tmp1V3P2301} 
&=
\begin{bmatrix}
c_2v_3 - c_3v_2\\
c_3v_0 - c_0v_3\\
c_0v_1 - c_1v_0\\
c_1v_2 - c_2v_1\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 tmp1V2P2301N = Negate<0, 1, 0, 1>(tmp1V2P2301);
__m128 tmp1V3P2301N = Negate<0, 1, 0, 1>(tmp1V3P2301);
\end{minted}

\begin{align*}
\mathrm{tmp1V2P2301N} 
=
\begin{bmatrix}
v_2d_3 - v_3d_2\\
v_0d_3 - v_3d_0\\
v_0d_1 - v_1d_0\\
v_2d_1 - v_1d_2\\
\end{bmatrix}
&&
\mathrm{tmp1V3P2301N} 
&=
\begin{bmatrix}
c_2v_3 - c_3v_2\\
c_0v_3 - c_3v_0\\
c_0v_1 - c_1v_0\\
c_2v_1 - c_1v_2\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 prod03V0 = _mmx_mul_p(tmp0V0, tmp1P2301N);
__m128 prod03V1 = _mmx_mul_p(tmp0V1, tmp1P2301N);
__m128 prod03V2 = _mmx_mul_p(tmp0, tmp1V2P2301N);
__m128 prod03V3 = _mmx_mul_p(tmp0, tmp1V3P2301N);
\end{minted}

\begin{align*}
\mathrm{prod03V0} 
=
\begin{bmatrix}
\pth{v_0b_1 - v_1b_0}\pth{c_2d_3 - c_3d_2}\\
\pth{v_1b_2 - v_2b_1}\pth{c_3d_0 - c_0d_3}\\
\pth{v_2b_3 - v_3b_2}\pth{c_0d_1 - c_1d_0}\\
\pth{v_3b_0 - v_0b_3}\pth{c_1d_2 - c_2d_1}\\
\end{bmatrix}
&&
\mathrm{prod03V1} 
&=
\begin{bmatrix}
\pth{a_0v_1 - a_1v_0}\pth{c_2d_3 - c_3d_2}\\
\pth{a_1v_2 - a_2v_1}\pth{c_3d_0 - c_0d_3}\\
\pth{a_2v_3 - a_3v_2}\pth{c_0d_1 - c_1d_0}\\
\pth{a_3v_0 - a_0v_3}\pth{c_1d_2 - c_2d_1}\\
\end{bmatrix}
\\
\mathrm{prod03V2} 
=
\begin{bmatrix}
\pth{a_0b_1 - a_1b_0}\pth{v_2d_3 - v_3d_2}\\
\pth{a_1b_2 - a_2b_1}\pth{v_0d_3 - v_3d_0}\\
\pth{a_2b_3 - a_3b_2}\pth{v_0d_1 - v_1d_0}\\
\pth{a_3b_0 - a_0b_3}\pth{v_2d_1 - v_1d_2}\\
\end{bmatrix}
&&
\mathrm{prod03V3} 
&=
\begin{bmatrix}
\pth{a_0b_1 - a_1b_0}\pth{c_2v_3 - c_3v_2}\\
\pth{a_1b_2 - a_2b_1}\pth{c_0v_3 - c_3v_0}\\
\pth{a_2b_3 - a_3b_2}\pth{c_0v_1 - c_1v_0}\\
\pth{a_3b_0 - a_0b_3}\pth{c_2v_1 - c_1v_2}\\
\end{bmatrix}
\end{align*}


\begin{minted}{cpp}
__m128 vP2301 = Permute<2, 3, 0, 1>(v);
\end{minted}

\begin{align*}
\mathrm{vP2301} 
=
\begin{bmatrix}
v_2\\
v_3\\
v_0\\
v_1\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 tmp4V02 = _mmx_fmsub_p(v, b3P2301, _mm_mul_ps(vP2301, b2));
__m128 tmp4V13 = _mmx_fmsub_p(b0, vP2301, _mm_mul_ps(b1P2301, v));
\end{minted}

\begin{align*}
\mathrm{tmp4V02} 
=
\begin{bmatrix}
v_0b_2- v_2b_0\\
v_1b_3- v_3b_1\\
v_2d_0- v_0d_2\\
v_3d_1- v_1d_3\\
\end{bmatrix}
&&
\mathrm{tmp4V13} 
&=
\begin{bmatrix}
a_0v_2 - a_2v_0\\
a_1v_3 - a_3v_1\\
c_2v_0 - c_0v_2\\
c_3v_1 - c_1v_3\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 prod03V02b0 = Blend<0, 0, 1, 1>(prod03V0, prod03V2);
__m128 prod03V02b1 = Blend<1, 1, 0, 0>(prod03V0, prod03V2);
__m128 prod03V13b0 = Blend<0, 0, 1, 1>(prod03V1, prod03V3);
__m128 prod03V13b1 = Blend<1, 1, 0, 0>(prod03V1, prod03V3);
\end{minted}

\begin{align*}
\mathrm{prod03V02b0} 
=
\begin{bmatrix}
\pth{v_0b_1 - v_1b_0}\pth{c_2d_3 - c_3d_2}\\
\pth{v_1b_2 - v_2b_1}\pth{c_3d_0 - c_0d_3}\\
\pth{a_2b_3 - a_3b_2}\pth{v_0d_1 - v_1d_0}\\
\pth{a_3b_0 - a_0b_3}\pth{v_2d_1 - v_1d_2}\\
\end{bmatrix}
&&
\mathrm{prod03V02b1} 
&=
\begin{bmatrix}
\pth{a_0b_1 - a_1b_0}\pth{v_2d_3 - v_3d_2}\\
\pth{a_1b_2 - a_2b_1}\pth{v_0d_3 - v_3d_0}\\
\pth{v_2b_3 - v_3b_2}\pth{c_0d_1 - c_1d_0}\\
\pth{v_3b_0 - v_0b_3}\pth{c_1d_2 - c_2d_1}\\
\end{bmatrix}
\\
\mathrm{prod03V13b0} 
=
\begin{bmatrix}
\pth{a_0v_1 - a_1v_0}\pth{c_2d_3 - c_3d_2}\\
\pth{a_1v_2 - a_2v_1}\pth{c_3d_0 - c_0d_3}\\
\pth{a_2b_3 - a_3b_2}\pth{c_0v_1 - c_1v_0}\\
\pth{a_3b_0 - a_0b_3}\pth{c_2v_1 - c_1v_2}\\
\end{bmatrix}
&&
\mathrm{prod03V13b1} 
&=
\begin{bmatrix}
\pth{a_0b_1 - a_1b_0}\pth{c_2v_3 - c_3v_2}\\
\pth{a_1b_2 - a_2b_1}\pth{c_0v_3 - c_3v_0}\\
\pth{a_2v_3 - a_3v_2}\pth{c_0d_1 - c_1d_0}\\
\pth{a_3v_0 - a_0v_3}\pth{c_1d_2 - c_2d_1}\\
\end{bmatrix}
\end{align*}


\begin{minted}{cpp}
__m128 prod03V02b1P2301 = Permute<2, 3, 0, 1>(prod03V02b1);
__m128 prod03V13b1P2301 = Permute<2, 3, 0, 1>(prod03V13b1);
\end{minted}

\begin{align*}
\mathrm{prod03V02b1P2301} 
=
\begin{bmatrix}
\pth{v_2b_3 - v_3b_2}\pth{c_0d_1 - c_1d_0}\\
\pth{v_3b_0 - v_0b_3}\pth{c_1d_2 - c_2d_1}\\
\pth{a_0b_1 - a_1b_0}\pth{v_2d_3 - v_3d_2}\\
\pth{a_1b_2 - a_2b_1}\pth{v_0d_3 - v_3d_0}\\
\end{bmatrix}
\\
\mathrm{prod03V13b1P2301} 
=
\begin{bmatrix}
\pth{a_2v_3 - a_3v_2}\pth{c_0d_1 - c_1d_0}\\
\pth{a_3v_0 - a_0v_3}\pth{c_1d_2 - c_2d_1}\\
\pth{a_0b_1 - a_1b_0}\pth{c_2v_3 - c_3v_2}\\
\pth{a_1b_2 - a_2b_1}\pth{c_0v_3 - c_3v_0}\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 prodSumV02 = 
    _mmx_fmadd_p(tmp4V02,tmp4P3210,_mmx_add_p(prod03V02b0,prod03V02b1P2301));
__m128 prodSumV13 =   
    _mmx_fmadd_p(tmp4V13,tmp4P3210,_mmx_add_p(prod03V13b0,prod03V13b1P2301));    
\end{minted}

\begin{align*}
\mathrm{prodSumV02} 
=
\begin{bmatrix}
  \pth{v_0b_2 - v_2b_0}\pth{c_3d_1 - c_1d_3}
+ \pth{v_0b_1 - v_1b_0}\pth{c_2d_3 - c_3d_2}
+ \pth{v_2b_3 - v_3b_2}\pth{c_0d_1 - c_1d_0}\\
  \pth{v_1b_3 - v_3b_1}\pth{c_2d_0 - c_0d_2}
+ \pth{v_1b_2 - v_2b_1}\pth{c_3d_0 - c_0d_3}
+ \pth{v_3b_0 - v_0b_3}\pth{c_1d_2 - c_2d_1}\\
  \pth{a_1b_3 - a_3b_1}\pth{v_2d_0 - v_0d_2}
+ \pth{a_2b_3 - a_3b_2}\pth{v_0d_1 - v_1d_0}
+ \pth{a_0b_1 - a_1b_0}\pth{v_2d_3 - v_3d_2}\\
  \pth{a_0b_2 - a_2b_0}\pth{v_3d_1 - v_1d_3}
+ \pth{a_3b_0 - a_0b_3}\pth{v_2d_1 - v_1d_2}
+ \pth{a_1b_2 - a_2b_1}\pth{v_0d_3 - v_3d_0}\\
\end{bmatrix}
\\
\mathrm{prodSumV13} 
=
\begin{bmatrix}
  \pth{a_0v_2 - a_2v_0}\pth{c_3d_1 - c_1d_3}
+ \pth{a_0v_1 - a_1v_0}\pth{c_2d_3 - c_3d_2}
+ \pth{a_2v_3 - a_3v_2}\pth{c_0d_1 - c_1d_0}\\
  \pth{a_1v_3 - a_3v_1}\pth{c_2d_0 - c_0d_2}
+ \pth{a_1v_2 - a_2v_1}\pth{c_3d_0 - c_0d_3}
+ \pth{a_3v_0 - a_0v_3}\pth{c_1d_2 - c_2d_1}\\
  \pth{a_1b_3 - a_3b_1}\pth{c_2v_0 - c_0v_2}
+ \pth{a_2b_3 - a_3b_2}\pth{c_0v_1 - c_1v_0}
+ \pth{a_0b_1 - a_1b_0}\pth{c_2v_3 - c_3v_2}\\
  \pth{a_0b_2 - a_2b_0}\pth{c_3v_1 - c_1v_3}
+ \pth{a_3b_0 - a_0b_3}\pth{c_2v_1 - c_1v_2}
+ \pth{a_1b_2 - a_2b_1}\pth{c_0v_3 - c_3v_0}\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 prodSumB0 = Blend<0,1,0,1>(prodSumV02,prodSumV13);
__m128 prodSumB1 = Blend<1,0,1,0>(prodSumV02,prodSumV13);
\end{minted}

\begin{align*}
\mathrm{prodSumB0} 
=
\begin{bmatrix}
  \pth{v_0b_2 - v_2b_0}\pth{c_3d_1 - c_1d_3}
+ \pth{v_0b_1 - v_1b_0}\pth{c_2d_3 - c_3d_2}
+ \pth{v_2b_3 - v_3b_2}\pth{c_0d_1 - c_1d_0}\\
  \pth{a_1v_3 - a_3v_1}\pth{c_2d_0 - c_0d_2}
+ \pth{a_1v_2 - a_2v_1}\pth{c_3d_0 - c_0d_3}
+ \pth{a_3v_0 - a_0v_3}\pth{c_1d_2 - c_2d_1}\\
  \pth{a_1b_3 - a_3b_1}\pth{v_2d_0 - v_0d_2}
+ \pth{a_2b_3 - a_3b_2}\pth{v_0d_1 - v_1d_0}
+ \pth{a_0b_1 - a_1b_0}\pth{v_2d_3 - v_3d_2}\\
  \pth{a_0b_2 - a_2b_0}\pth{c_3v_1 - c_1v_3}
+ \pth{a_3b_0 - a_0b_3}\pth{c_2v_1 - c_1v_2}
+ \pth{a_1b_2 - a_2b_1}\pth{c_0v_3 - c_3v_0}\\
\end{bmatrix}
\\
\mathrm{prodSumB1} 
=
\begin{bmatrix}
  \pth{a_0v_2 - a_2v_0}\pth{c_3d_1 - c_1d_3}
+ \pth{a_0v_1 - a_1v_0}\pth{c_2d_3 - c_3d_2}
+ \pth{a_2v_3 - a_3v_2}\pth{c_0d_1 - c_1d_0}\\
  \pth{v_1b_3 - v_3b_1}\pth{c_2d_0 - c_0d_2}
+ \pth{v_1b_2 - v_2b_1}\pth{c_3d_0 - c_0d_3}
+ \pth{v_3b_0 - v_0b_3}\pth{c_1d_2 - c_2d_1}\\
  \pth{a_1b_3 - a_3b_1}\pth{c_2v_0 - c_0v_2}
+ \pth{a_2b_3 - a_3b_2}\pth{c_0v_1 - c_1v_0}
+ \pth{a_0b_1 - a_1b_0}\pth{c_2v_3 - c_3v_2}\\
  \pth{a_0b_2 - a_2b_0}\pth{v_3d_1 - v_1d_3}
+ \pth{a_3b_0 - a_0b_3}\pth{v_2d_1 - v_1d_2}
+ \pth{a_1b_2 - a_2b_1}\pth{v_0d_3 - v_3d_0}\\
\end{bmatrix}
\end{align*}


\begin{minted}{cpp}
__m128 prodSumB1P1032 = Permute<1,0,3,2>(prodSumB1);
\end{minted}

\begin{align*}
\mathrm{prodSumB1P1032} 
=
\begin{bmatrix}
  \pth{v_1b_3 - v_3b_1}\pth{c_2d_0 - c_0d_2}
+ \pth{v_1b_2 - v_2b_1}\pth{c_3d_0 - c_0d_3}
+ \pth{v_3b_0 - v_0b_3}\pth{c_1d_2 - c_2d_1}\\
  \pth{a_0v_2 - a_2v_0}\pth{c_3d_1 - c_1d_3}
+ \pth{a_0v_1 - a_1v_0}\pth{c_2d_3 - c_3d_2}
+ \pth{a_2v_3 - a_3v_2}\pth{c_0d_1 - c_1d_0}\\
  \pth{a_0b_2 - a_2b_0}\pth{v_3d_1 - v_1d_3}
+ \pth{a_3b_0 - a_0b_3}\pth{v_2d_1 - v_1d_2}
+ \pth{a_1b_2 - a_2b_1}\pth{v_0d_3 - v_3d_0}\\
  \pth{a_1b_3 - a_3b_1}\pth{c_2v_0 - c_0v_2}
+ \pth{a_2b_3 - a_3b_2}\pth{c_0v_1 - c_1v_0}
+ \pth{a_0b_1 - a_1b_0}\pth{c_2v_3 - c_3v_2}\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 determinants = _mmx_add_p(prodSumB0, prodSumB1P1032);
\end{minted}


\begin{align*}
\mathrm{determinants} 
=
\begin{bmatrix}
\mathrm{detV0}\\
\mathrm{detV1}\\
\mathrm{detV2}\\
\mathrm{detV3}\\
\end{bmatrix}
\end{align*}

\begin{minted}{cpp}
__m128 result = _mmx_div_p(determinants, detA);
\end{minted}

% AVX --------------------------------------------------------------------------

\subsubsection{4x4 Determinant - AVX}
\label{sec:determinant4x4AVX}

\begin{align*}
  a_0c_1 \pth{b_3d_2 - b_2d_3}
+ a_0c_2 \pth{b_1d_3 - b_3d_1}            
+ a_0c_3 \pth{b_2d_1 - b_1d_2}\\
+ a_1c_0 \pth{b_2d_3 - b_3d_2}
+ a_1c_2 \pth{b_3d_0 - b_0d_3}
+ a_1c_3 \pth{b_0d_2 - b_2d_0}\\
+ a_2c_0 \pth{b_3d_1 - b_1d_3}
+ a_2c_1 \pth{b_0d_3 - b_3d_0}
+ a_2c_3 \pth{b_1d_0 - b_0d_1}\\
+ a_3c_0 \pth{b_1d_2 - b_2d_1}
+ a_3c_1 \pth{b_2d_0 - b_0d_2}
+ a_3c_2 \pth{b_0d_1 - b_1d_0}
\end{align*}

\begin{align*}
  \pth{a_0c_1 - a_1c_0} \pth{b_3d_2 - b_2d_3} \\
+ \pth{a_0c_2 - a_2c_0} \pth{b_1d_3 - b_3d_1} \\
+ \pth{a_0c_3 - a_3c_0} \pth{b_2d_1 - b_1d_2} \\
+ \pth{a_1c_2 - a_2c_1} \pth{b_3d_0 - b_0d_3} \\
+ \pth{a_1c_3 - a_3c_1} \pth{b_0d_2 - b_2d_0} \\ 
+ \pth{a_2c_3 - a_3c_2} \pth{b_1d_0 - b_0d_1} \\ 
\end{align*}

Reorder equations and switch orders of terms to optimize for AVX registers:

\begin{align}
  \pth{a_0c_1 - a_1c_0} \pth{b_3d_2 - b_2d_3} \nonumber\\
+ \pth{a_1c_2 - a_2c_1} \pth{b_3d_0 - b_0d_3} \nonumber\\ 
+ \pth{a_2c_3 - a_3c_2} \pth{b_1d_0 - b_0d_1} \nonumber\\
+ \pth{a_3c_0 - a_0c_3} \pth{b_1d_2 - b_2d_1} \nonumber\\
+ \pth{a_0c_2 - a_2c_0} \pth{b_1d_3 - b_3d_1} \nonumber\\
+ \pth{a_1c_3 - a_3c_1} \pth{b_0d_2 - b_2d_0} 
\end{align}


Matrix as two \mintinline{cpp}{__m256} registers:

\begin{align*}
\mathrm{col01} 
=
\begin{bmatrix}
a_0\\
a_1\\
a_2\\
a_3\\
b_0\\
b_1\\
b_2\\
b_3\\
\end{bmatrix}
&&
\mathrm{col23} 
&=
\begin{bmatrix}
c_0\\
c_1\\
c_2\\
c_3\\
d_0\\
d_1\\
d_2\\
d_3\\
\end{bmatrix}
\end{align*}

Permutation 1230 of col01 and col23:

\begin{align*}
\mathrm{col01P1230} 
=
\begin{bmatrix}
a_1\\
a_2\\
a_3\\
a_0\\
b_1\\
b_2\\
b_3\\
b_0\\
\end{bmatrix}
&&
\mathrm{col23P1230} 
=
\begin{bmatrix}
c_1\\
c_2\\
c_3\\
c_0\\
d_1\\
d_2\\
d_3\\
d_0\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{__mm256_fmsub_ps(col01, col23P1230, _mm256_mul_ps(col01P1230, col23))}:

\begin{align*}
\mathrm{tmp0} 
&=
\begin{bmatrix}
a_0c_1 - a_1c_0\\
a_1c_2 - a_2c_1\\
a_2c_3 - a_3c_2\\
a_3c_0 - a_0c_3\\
b_0d_1 - b_1d_0\\
b_1d_2 - b_2d_1\\
b_2d_3 - b_3d_2\\
b_3d_0 - b_0d_3\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{Negate<0,0,0,0,1,0,1,0>} 

\begin{align*}
\mathrm{tmp0} 
&=
\begin{bmatrix}
a_0c_1 - a_1c_0\\
a_1c_2 - a_2c_1\\
a_2c_3 - a_3c_2\\
a_3c_0 - a_0c_3\\
b_1d_0 - b_0d_1\\
b_1d_2 - b_2d_1\\
b_3d_2 - b_2d_3\\
b_3d_0 - b_0d_3\\
\end{bmatrix}
\end{align*}



Permutation 2323 of col01 and col23:

\begin{align*}
\mathrm{col01P1230} 
=
\begin{bmatrix}
a_2\\
a_3\\
a_2\\
a_3\\
b_2\\
b_3\\
b_2\\
b_3\\
\end{bmatrix}
&&
\mathrm{col23P1230} 
&=
\begin{bmatrix}
c_2\\
c_3\\
c_2\\
c_3\\
d_2\\
d_3\\
d_2\\
d_3\\
\end{bmatrix}
\end{align*}


\mintinline{cpp}{_mm256_fmsub_ps(col01, col23P2323, _mm256_mul_ps(col01P2323, col23))}:
\begin{align*}
\mathrm{tmp1} 
&=
\begin{bmatrix}
a_0c_2 - a_2c_0\\
a_1c_3 - a_3c_1\\
a_2c_2 - a_2c_2\\
a_3c_3 - a_3c_3\\
b_0d_2 - b_2d_0\\
b_1d_3 - b_3d_1\\
b_2d_2 - b_2d_2\\
b_3d_3 - b_3d_3\\
\end{bmatrix}
=
\begin{bmatrix}
a_0c_2 - a_2c_0\\
a_1c_3 - a_3c_1\\
0\\
0\\
b_0d_2 - b_2d_0\\
b_1d_3 - b_3d_1\\
0\\
0\\
\end{bmatrix}
\end{align*}


\mintinline{cpp}{Blend<0, 0, 0, 0, 1, 1, 1, 1>(tmp0, tmp1)}:

\begin{align*}
\mathrm{tmp2} 
&=
\begin{bmatrix}
a_0c_1 - a_1c_0\\
a_1c_2 - a_2c_1\\
a_2c_3 - a_3c_2\\
a_3c_0 - a_0c_3\\
b_0d_2 - b_2d_0\\
b_1d_3 - b_3d_1\\
0\\
0\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{Permute2F128<0, 1, 1, 0>(tmp0, tmp1)}:
\begin{align*}
\mathrm{tmp3} 
&=
\begin{bmatrix}
b_1d_0 - b_0d_1\\
b_1d_2 - b_2d_1\\
b_3d_2 - b_2d_3\\
b_3d_0 - b_0d_3\\
a_0c_2 - a_2c_0\\
a_1c_3 - a_3c_1\\
0\\
0\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{Permute<2, 3, 0, 1, 1, 0, 2, 3>(tmp3)}:
\begin{align*}
\mathrm{tmp3} 
&=
\begin{bmatrix}
b_3d_2 - b_2d_3\\
b_3d_0 - b_0d_3\\
b_1d_0 - b_0d_1\\
b_1d_2 - b_2d_1\\
a_1c_3 - a_3c_1\\
a_0c_2 - a_2c_0\\
0\\
0\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{DotProduct(tmp2, tmp3)}:

\begin{align*}
\mathrm{tmp4} 
&=
\begin{bmatrix}
	\mathrm{dot03}\\
	\mathrm{dot03}\\
	\mathrm{dot03}\\
	\mathrm{dot03}\\
	\mathrm{dot47}\\
	\mathrm{dot47}\\
	\mathrm{dot47}\\
	\mathrm{dot47}\\
\end{bmatrix}\\
\\
\mathrm{dot03}
&=\pth{a_0c_1 - a_1c_0}\pth{b_3d_2 - b_2d_3}\\
&+\pth{a_1c_2 - a_2c_1}\pth{b_3d_0 - b_0d_3}\\
&+\pth{a_2c_3 - a_3c_2}\pth{b_1d_0 - b_0d_1}\\
&+\pth{a_3c_0 - a_0c_3}\pth{b_1d_2 - b_2d_1}\\
\\
\mathrm{dot47}
&=\pth{a_1c_3 - a_3c_1}\pth{b_0d_2 - b_2d_0}\\
&+\pth{a_0c_2 - a_2c_0}\pth{b_1d_3 - b_3d_1}
\end{align*}

Finally, \mintinline{cpp}{_mmx_add_p(tmp4, Permute2F128<1, 0>(tmp4))} creates a register with all values being equal to the determinant of the matrix:

\begin{align*}
\mathrm{detA} 
&=
\begin{bmatrix}
\mathrm{dot03} + \mathrm{dot47}\\
\mathrm{dot03} + \mathrm{dot47}\\
\mathrm{dot03} + \mathrm{dot47}\\
\mathrm{dot03} + \mathrm{dot47}\\
\mathrm{dot03} + \mathrm{dot47}\\
\mathrm{dot03} + \mathrm{dot47}\\
\mathrm{dot03} + \mathrm{dot47}\\
\mathrm{dot03} + \mathrm{dot47}\\
\end{bmatrix}\\
\end{align*}

The determinant is returned as a single \mintinline{cpp}{F32} by using \mintinline{cpp}{_mm256_cvtss_f32(result)}.

The whole function looks like this:
\begin{minted}{cpp}
inline F32 Determinant4x4(__m256 col01, __m256 col23)
{
    __m256 col01P1230 = Permute<1, 2, 3, 0>(col01);
    __m256 col23P1230 = Permute<1, 2, 3, 0>(col23);
    __m256 tmp0 = _mmx_fmsub_p(col01, col23P1230, _mmx_mul_p(col23, col01P1230));
    tmp0 = Negate<0, 0, 0, 0, 1, 0, 1, 0>(tmp0);

    __m256 col01P2323 = Permute<2, 3, 2, 3>(col01);
    __m256 col23P2323 = Permute<2, 3, 2, 3>(col23);
    __m256 tmp1 = _mmx_fmsub_p(col01, col23P2323, _mmx_mul_p(col23, col01P2323));

    __m256 tmp2 = Blend<0, 0, 0, 0, 1, 1, 1, 1>(tmp0, tmp1);
    __m256 tmp3 = Permute2F128<0, 1, 1, 0>(tmp0, tmp1);
    tmp3 = Permute<2, 3, 0, 1, 1, 0, 2, 3>(tmp3);

    __m256 tmp4 = DotProduct(tmp2, tmp3);

    __m256 result = _mmx_add_p(tmp4, Permute2F128<1, 0>(tmp4));
    return _mm256_cvtss_f32(result);
}
\end{minted}

\subsubsection{4x4 Solver - AVX}

The first implementation part of the 4x4 solver is identical to the calculation of an 4x4 determinant as described in \cref{sec:determinant4x4AVX}. The return statement, is replaced by a check if the determinant is 0:
\begin{minted}{cpp}
DEV_EXCEPTION(_mm256_cvtss_f32(detA) == ApproxZero<F32>(10), 
              "Singular matrix - system not solveable");
\end{minted} 

Create the register that contains the right hand side values and its 
\mintinline{cpp}{<1, 2, 3, 0>} permutation:

\begin{align*}
\mathrm{v} 
=
\begin{bmatrix}
v_0\\
v_1\\
v_2\\
v_3\\
v_0\\
v_1\\
v_2\\
v_3
\end{bmatrix}
&&
\mathrm{vP1230} 
&=
\begin{bmatrix}
v_1\\
v_2\\
v_3\\
v_0\\
v_1\\
v_2\\
v_3\\
v_0\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{_mmx_fmsub_p(v, col23P1230, _mmx_mul_p(vP1230, col23))} and \newline \mintinline{cpp}{_mmx_fmsub_p(col01, v, _mmx_mul_p(col01P1230, v))}:

\begin{align*}
\mathrm{tmp0V01} 
=
\begin{bmatrix}
v_0c_1 - v_1c_0\\
v_1c_2 - v_2c_1\\
v_2c_3 - v_3c_2\\
v_3c_0 - v_0c_3\\
v_0d_1 - v_1d_0\\
v_1d_2 - v_2d_1\\
v_2d_3 - v_3d_2\\
v_3d_0 - v_0d_3\\
\end{bmatrix}
&&
\mathrm{tmp0V23} 
&=
\begin{bmatrix}
a_0v_1 - a_1v_0\\
a_1v_2 - a_2v_1\\
a_2v_3 - a_3v_2\\
a_3v_0 - a_0v_3\\
b_0v_1 - b_1v_0\\
b_1v_2 - b_2v_1\\
b_2v_3 - b_3v_2\\
b_3v_0 - b_0v_3\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{Negate<0, 0, 0, 0, 1, 0, 1, 0>(tmp0V01)} and \newline \mintinline{cpp}{Negate<0, 0, 0, 0, 1, 0, 1, 0>(tmp0V23)}: 

\begin{align*}
\mathrm{tmp0V01} 
=
\begin{bmatrix}
v_0c_1 - v_1c_0\\
v_1c_2 - v_2c_1\\
v_2c_3 - v_3c_2\\
v_3c_0 - v_0c_3\\
v_1d_0 - v_0d_1\\
v_1d_2 - v_2d_1\\
v_3d_2 - v_2d_3\\
v_3d_0 - v_0d_3\\
\end{bmatrix}
&&
\mathrm{tmp0V23} 
&=
\begin{bmatrix}
a_0v_1 - a_1v_0\\
a_1v_2 - a_2v_1\\
a_2v_3 - a_3v_2\\
a_3v_0 - a_0v_3\\
b_1v_0 - b_0v_1\\
b_1v_2 - b_2v_1\\
b_3v_2 - b_2v_3\\
b_3v_0 - b_0v_3\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{Permute2F128<1, 0>(tmp0)}:

\begin{align*}
\mathrm{tmp0SL} 
&=
\begin{bmatrix}
b_1d_0 - b_0d_1\\
b_1d_2 - b_2d_1\\
b_3d_2 - b_2d_3\\
b_3d_0 - b_0d_3\\
a_0c_1 - a_1c_0\\
a_1c_2 - a_2c_1\\
a_2c_3 - a_3c_2\\
a_3c_0 - a_0c_3\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{Permute<2, 3, 0, 1>(tmp0SL)}:
\begin{align*}
\mathrm{tmp0SL} 
&=
\begin{bmatrix}
b_3d_2 - b_2d_3\\
b_3d_0 - b_0d_3\\
b_1d_0 - b_0d_1\\
b_1d_2 - b_2d_1\\
a_2c_3 - a_3c_2\\
a_3c_0 - a_0c_3\\
a_0c_1 - a_1c_0\\
a_1c_2 - a_2c_1\\
\end{bmatrix}
\end{align*}


\mintinline{cpp}{_mmx_mul_p(tmp0V01,tmp0SLP2301)} and \newline
\mintinline{cpp}{_mmx_mul_p(tmp0V23,tmp0SLP2301)}:
\begin{align*}
\mathrm{prod03V01} 
=
\begin{bmatrix}
\pth{v_0c_1 - v_1c_0}\pth{b_3d_2 - b_2d_3}\\
\pth{v_1c_2 - v_2c_1}\pth{b_3d_0 - b_0d_3}\\
\pth{v_2c_3 - v_3c_2}\pth{b_1d_0 - b_0d_1}\\
\pth{v_3c_0 - v_0c_3}\pth{b_1d_2 - b_2d_1}\\
\pth{a_2c_3 - a_3c_2}\pth{v_1d_0 - v_0d_1}\\
\pth{a_3c_0 - a_0c_3}\pth{v_1d_2 - v_2d_1}\\
\pth{a_0c_1 - a_1c_0}\pth{v_3d_2 - v_2d_3}\\
\pth{a_1c_2 - a_2c_1}\pth{v_3d_0 - v_0d_3}\\
\end{bmatrix}
&&
\mathrm{prod03V23} 
=&
\begin{bmatrix}
\pth{a_0v_1 - a_1v_0}\pth{b_3d_2 - b_2d_3}\\
\pth{a_1v_2 - a_2v_1}\pth{b_3d_0 - b_0d_3}\\
\pth{a_2v_3 - a_3v_2}\pth{b_1d_0 - b_0d_1}\\
\pth{a_3v_0 - a_0v_3}\pth{b_1d_2 - b_2d_1}\\
\pth{a_2c_3 - a_3c_2}\pth{b_1v_0 - b_0v_1}\\
\pth{a_3c_0 - a_0c_3}\pth{b_1v_2 - b_2v_1}\\
\pth{a_0c_1 - a_1c_0}\pth{b_3v_2 - b_2v_3}\\
\pth{a_1c_2 - a_2c_1}\pth{b_3v_0 - b_0v_3}\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{Blend<0, 0, 1, 1, 0, 0, 1, 1>(prod03V01, prod03V23)} and \newline
\mintinline{cpp}{Blend<1, 1, 0, 0, 1, 1, 0, 0>(prod03V01, prod03V23)}:
\begin{align*}
\mathrm{prod03B0} 
=
\begin{bmatrix}
\pth{v_0c_1 - v_1c_0}\pth{b_3d_2 - b_2d_3}\\
\pth{v_1c_2 - v_2c_1}\pth{b_3d_0 - b_0d_3}\\
\pth{a_2v_3 - a_3v_2}\pth{b_1d_0 - b_0d_1}\\
\pth{a_3v_0 - a_0v_3}\pth{b_1d_2 - b_2d_1}\\
\pth{a_2c_3 - a_3c_2}\pth{v_1d_0 - v_0d_1}\\
\pth{a_3c_0 - a_0c_3}\pth{v_1d_2 - v_2d_1}\\
\pth{a_0c_1 - a_1c_0}\pth{b_3v_2 - b_2v_3}\\
\pth{a_1c_2 - a_2c_1}\pth{b_3v_0 - b_0v_3}\\
\end{bmatrix}
&&
\mathrm{prod03B1} 
&=
\begin{bmatrix}
\pth{a_0v_1 - a_1v_0}\pth{b_3d_2 - b_2d_3}\\
\pth{a_1v_2 - a_2v_1}\pth{b_3d_0 - b_0d_3}\\
\pth{v_2c_3 - v_3c_2}\pth{b_1d_0 - b_0d_1}\\
\pth{v_3c_0 - v_0c_3}\pth{b_1d_2 - b_2d_1}\\
\pth{a_2c_3 - a_3c_2}\pth{b_1v_0 - b_0v_1}\\
\pth{a_3c_0 - a_0c_3}\pth{b_1v_2 - b_2v_1}\\
\pth{a_0c_1 - a_1c_0}\pth{v_3d_2 - v_2d_3}\\
\pth{a_1c_2 - a_2c_1}\pth{v_3d_0 - v_0d_3}\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{Permute<2, 3, 0, 1>(prod03B)}
\begin{align*}
\mathrm{prod03BP2301} 
=
\begin{bmatrix}
\pth{v_2c_3 - v_3c_2}\pth{b_1d_0 - b_0d_1}\\
\pth{v_3c_0 - v_0c_3}\pth{b_1d_2 - b_2d_1}\\
\pth{a_0v_1 - a_1v_0}\pth{b_3d_2 - b_2d_3}\\
\pth{a_1v_2 - a_2v_1}\pth{b_3d_0 - b_0d_3}\\
\pth{a_0c_1 - a_1c_0}\pth{v_3d_2 - v_2d_3}\\
\pth{a_1c_2 - a_2c_1}\pth{v_3d_0 - v_0d_3}\\
\pth{a_2c_3 - a_3c_2}\pth{b_1v_0 - b_0v_1}\\
\pth{a_3c_0 - a_0c_3}\pth{b_1v_2 - b_2v_1}\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{_mmx_add_p(prod03B0, prod03B1P2301)}:
\begin{align*}
\mathrm{prodSum03} 
=
\begin{bmatrix}
	\pth{v_0c_1 - v_1c_0}\pth{b_3d_2 - b_2d_3} 
  + \pth{v_2c_3 - v_3c_2}\pth{b_1d_0 - b_0d_1}\\
	\pth{v_1c_2 - v_2c_1}\pth{b_3d_0 - b_0d_3}
  + \pth{v_3c_0 - v_0c_3}\pth{b_1d_2 - b_2d_1}\\
	\pth{a_2v_3 - a_3v_2}\pth{b_1d_0 - b_0d_1}
  + \pth{a_0v_1 - a_1v_0}\pth{b_3d_2 - b_2d_3}\\
	\pth{a_3v_0 - a_0v_3}\pth{b_1d_2 - b_2d_1}
  + \pth{a_1v_2 - a_2v_1}\pth{b_3d_0 - b_0d_3}\\
	\pth{a_2c_3 - a_3c_2}\pth{v_1d_0 - v_0d_1}
  +	\pth{a_0c_1 - a_1c_0}\pth{v_3d_2 - v_2d_3}\\
	\pth{a_3c_0 - a_0c_3}\pth{v_1d_2 - v_2d_1}
  + \pth{a_1c_2 - a_2c_1}\pth{v_3d_0 - v_0d_3}\\
	\pth{a_0c_1 - a_1c_0}\pth{b_3v_2 - b_2v_3}
  + \pth{a_2c_3 - a_3c_2}\pth{b_1v_0 - b_0v_1}\\
	\pth{a_1c_2 - a_2c_1}\pth{b_3v_0 - b_0v_3}
  + \pth{a_3c_0 - a_0c_3}\pth{b_1v_2 - b_2v_1}\\
\end{bmatrix}
\end{align*}





\mintinline{cpp}{Blend<0, 0, 1, 1, 0, 0, 1, 1>(col01, col23)} and \newline
\mintinline{cpp}{Blend<1, 1, 0, 0, 1, 1, 0, 0>(col01, col23)}:
\begin{align*}
\mathrm{blend0} 
=
\begin{bmatrix}
a_0\\
a_1\\
c_2\\
c_3\\
b_0\\
b_1\\
d_2\\
d_3\\
\end{bmatrix}
&&
\mathrm{blend1} 
=
\begin{bmatrix}
c_0\\
c_1\\
a_2\\
a_3\\
d_0\\
d_1\\
b_2\\
b_3\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{Permute<2, 3, 0, 1>(blend0)}
\begin{align*}
\mathrm{blend0P2301} 
=
\begin{bmatrix}
c_2\\
c_3\\
a_0\\
a_1\\
d_2\\
d_3\\
b_0\\
b_1\\
\end{bmatrix}
\end{align*}


\mintinline{cpp}{Permute<2, 3, 0, 1>(v)}:
\begin{align*}
\mathrm{vP2301} 
=
\begin{bmatrix}
v_2\\
v_3\\
v_0\\
v_1\\
v_2\\
v_3\\
v_0\\
v_1\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{_mmx_fmsub_p(blend0P2301, v, _mmx_mul_p(vP2301, blend1))}:
\begin{align*}
\mathrm{tmp1V} 
=
\begin{bmatrix}
v_0c_2 - v_2c_0\\
v_1c_3 - v_3c_1\\
a_0v_2 - a_2v_0\\
a_1v_3 - a_3v_1\\
v_0d_2 - v_2d_0\\
v_1d_3 - v_3d_1\\
b_0v_2 - b_2v_0\\
b_1v_3 - b_3v_1\\
\end{bmatrix}
\end{align*}


\mintinline{cpp}{Permute2F128<1, 0>(tmp1)}:
\begin{align*}
\mathrm{tmp1SL} 
&=
\begin{bmatrix}
	b_0d_2 - b_2d_0\\
	b_1d_3 - b_3d_1\\
	0\\
	0\\
	a_0c_2 - a_2c_0\\
	a_1c_3 - a_3c_1\\
	0\\
	0\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{Permute<1, 0, 1, 0>(tmp1SL)}
\begin{align*}
\mathrm{tmp1SLP1010} 
&=
\begin{bmatrix}
	b_1d_3 - b_3d_1\\
	b_0d_2 - b_2d_0\\
	b_1d_3 - b_3d_1\\
	b_0d_2 - b_2d_0\\
	a_1c_3 - a_3c_1\\	
	a_0c_2 - a_2c_0\\
	a_1c_3 - a_3c_1\\	
	a_0c_2 - a_2c_0\\	
\end{bmatrix}
\end{align*}


\mintinline{cpp}{_mmx_mul_p(tmp1V, tmp1SLP1010)}:
\begin{align*}
\mathrm{prod45V} 
=
\begin{bmatrix}
\pth{v_0c_2 - v_2c_0}\pth{b_1d_3 - b_3d_1}\\
\pth{v_1c_3 - v_3c_1}\pth{b_0d_2 - b_2d_0}\\
\pth{a_0v_2 - a_2v_0}\pth{b_1d_3 - b_3d_1}\\
\pth{a_1v_3 - a_3v_1}\pth{b_0d_2 - b_2d_0}\\
\pth{a_1c_3 - a_3c_1}\pth{v_0d_2 - v_2d_0}\\
\pth{a_0c_2 - a_2c_0}\pth{v_1d_3 - v_3d_1}\\
\pth{a_1c_3 - a_3c_1}\pth{b_0v_2 - b_2v_0}\\
\pth{a_0c_2 - a_2c_0}\pth{b_1v_3 - b_3v_1}\\
\end{bmatrix}
\end{align*}


\mintinline{cpp}{_mmx_add_p(prodSum03,prod45V)}:
\begin{align*}
\mathrm{prodSum05} 
=
\begin{bmatrix}
  \pth{v_0c_1 - v_1c_0}\pth{b_3d_2 - b_2d_3} 
+ \pth{v_2c_3 - v_3c_2}\pth{b_1d_0 - b_0d_1}
+ \pth{v_0c_2 - v_2c_0}\pth{b_1d_3 - b_3d_1}\\
  \pth{v_1c_2 - v_2c_1}\pth{b_3d_0 - b_0d_3}
+ \pth{v_3c_0 - v_0c_3}\pth{b_1d_2 - b_2d_1}
+ \pth{v_1c_3 - v_3c_1}\pth{b_0d_2 - b_2d_0}\\
  \pth{a_2v_3 - a_3v_2}\pth{b_1d_0 - b_0d_1}
+ \pth{a_0v_1 - a_1v_0}\pth{b_3d_2 - b_2d_3}
+ \pth{a_0v_2 - a_2v_0}\pth{b_1d_3 - b_3d_1}\\
  \pth{a_3v_0 - a_0v_3}\pth{b_1d_2 - b_2d_1}
+ \pth{a_1v_2 - a_2v_1}\pth{b_3d_0 - b_0d_3}
+ \pth{a_1v_3 - a_3v_1}\pth{b_0d_2 - b_2d_0}\\
  \pth{a_2c_3 - a_3c_2}\pth{v_1d_0 - v_0d_1}
+ \pth{a_0c_1 - a_1c_0}\pth{v_3d_2 - v_2d_3}
+ \pth{a_1c_3 - a_3c_1}\pth{v_0d_2 - v_2d_0}\\
  \pth{a_3c_0 - a_0c_3}\pth{v_1d_2 - v_2d_1}
+ \pth{a_1c_2 - a_2c_1}\pth{v_3d_0 - v_0d_3}
+ \pth{a_0c_2 - a_2c_0}\pth{v_1d_3 - v_3d_1}\\
  \pth{a_0c_1 - a_1c_0}\pth{b_3v_2 - b_2v_3}
+ \pth{a_2c_3 - a_3c_2}\pth{b_1v_0 - b_0v_1}
+ \pth{a_1c_3 - a_3c_1}\pth{b_0v_2 - b_2v_0}\\
  \pth{a_1c_2 - a_2c_1}\pth{b_3v_0 - b_0v_3}
+ \pth{a_3c_0 - a_0c_3}\pth{b_1v_2 - b_2v_1}
+ \pth{a_0c_2 - a_2c_0}\pth{b_1v_3 - b_3v_1}\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{_mmx_add_p(prodSum05, Permute<1, 0, 3, 2>(prodSum05))}:
\begin{align*}
\mathrm{determinants} 
&=
\begin{bmatrix}
\mathrm{detV0}\\
\mathrm{detV0}\\
\mathrm{detV2}\\
\mathrm{detV2}\\
\mathrm{detV1}\\
\mathrm{detV1}\\
\mathrm{detV3}\\
\mathrm{detV3}\\
\end{bmatrix}
\end{align*}


\mintinline{cpp}{Permute2F128<1, 0>(determinants)}:
\begin{align*}
\mathrm{determinantsSL} 
&=
\begin{bmatrix}
\mathrm{detV1}\\
\mathrm{detV1}\\
\mathrm{detV3}\\
\mathrm{detV3}\\
\mathrm{detV0}\\
\mathrm{detV0}\\
\mathrm{detV2}\\
\mathrm{detV2}\\
\end{bmatrix}
\end{align*}

\mintinline{cpp}{Blend<0, 1, 0, 1, 1, 0, 1, 0>(determinants, determinantsSL)}:
\begin{align*}
\mathrm{determinantsFinal} 
&=
\begin{bmatrix}
\mathrm{detV0}\\
\mathrm{detV1}\\
\mathrm{detV2}\\
\mathrm{detV3}\\
\mathrm{detV0}\\
\mathrm{detV1}\\
\mathrm{detV2}\\
\mathrm{detV3}\\
\end{bmatrix}
\end{align*}


The whole function looks like this:

\begin{minted}{cpp}
inline Vec4fSSE<true> Cramer(const Mat4fAVX& A, const Vec4fSSE<true>& b)
{
    using namespace GDL::sse;

    // Calculate determinant of A

    const std::array<__m256, 2>& dataA = A.DataAVX();
    const __m256& col01 = dataA[0];
    const __m256& col23 = dataA[1];

    __m256 col01P1230 = Permute<1, 2, 3, 0>(col01);
    __m256 col23P1230 = Permute<1, 2, 3, 0>(col23);
    __m256 tmp0 = _mmx_fmsub_p(col01, col23P1230, _mmx_mul_p(col23, col01P1230));
    tmp0 = Negate<0, 0, 0, 0, 1, 0, 1, 0>(tmp0);

    __m256 col01P2323 = Permute<2, 3, 2, 3>(col01);
    __m256 col23P2323 = Permute<2, 3, 2, 3>(col23);
    __m256 tmp1 = _mmx_fmsub_p(col01, col23P2323, _mmx_mul_p(col23, col01P2323));

    __m256 tmp2 = Blend<0, 0, 0, 0, 1, 1, 1, 1>(tmp0, tmp1);
    __m256 tmp3 = Permute2F128<0, 1, 1, 0>(tmp0, tmp1);
    tmp3 = Permute<2, 3, 0, 1, 1, 0, 2, 3>(tmp3);

    __m256 tmp4 = DotProduct(tmp2, tmp3);

    __m256 detA = _mmx_add_p(tmp4, Permute2F128<1, 0>(tmp4));

    DEV_EXCEPTION(_mm256_cvtss_f32(detA) == ApproxZero<F32>(10), "Singular matrix - system not solveable");

    const __m256 v = _mm256_insertf128_ps(_mm256_castps128_ps256(b.DataSSE()), b.DataSSE(), 1);
    __m256 vP1230 = Permute<1, 2, 3, 0>(v);


    // Calculate first 4 products of all modified matrix determinants

    __m256 tmp0V01 = _mmx_fmsub_p(v, col23P1230, _mmx_mul_p(vP1230, col23));
    tmp0V01 = Negate<0, 0, 0, 0, 1, 0, 1, 0>(tmp0V01);
    __m256 tmp0V23 = _mmx_fmsub_p(col01, vP1230, _mmx_mul_p(v, col01P1230));
    tmp0V23 = Negate<0, 0, 0, 0, 1, 0, 1, 0>(tmp0V23);

    __m256 tmp0SL = Permute2F128<1, 0>(tmp0);
    __m256 tmp0SLP2301 = Permute<2, 3, 0, 1>(tmp0SL);

    __m256 prod03V01 = _mmx_mul_p(tmp0V01, tmp0SLP2301);
    __m256 prod03V23 = _mmx_mul_p(tmp0V23, tmp0SLP2301);
    __m256 prod03B0 = Blend<0, 0, 1, 1, 0, 0, 1, 1>(prod03V01, prod03V23);
    __m256 prod03B1 = Blend<1, 1, 0, 0, 1, 1, 0, 0>(prod03V01, prod03V23);
    __m256 prod03B1P2301 = Permute<2, 3, 0, 1>(prod03B1);

    __m256 prodSum03 = _mmx_add_p(prod03B0, prod03B1P2301);


    // Calculate last 2 products of all modified matrix determinants

    __m256 blend1 = Blend<1, 1, 0, 0, 1, 1, 0, 0>(col01, col23);
    __m256 blend0 = Blend<0, 0, 1, 1, 0, 0, 1, 1>(col01, col23);
    __m256 blend0P2301 = Permute<2, 3, 0, 1>(blend0);

    __m256 vP2301 = Permute<2, 3, 0, 1>(v);

    __m256 tmp1V = _mmx_fmsub_p(blend0P2301, v, _mmx_mul_p(vP2301, blend1));
    __m256 tmp1SL = Permute2F128<1, 0>(tmp1);
    __m256 tmp1SLP1010 = Permute<1, 0, 1, 0>(tmp1SL);

    __m256 prod45V = _mmx_mul_p(tmp1V, tmp1SLP1010);


    // Calculate result

    __m256 prodSum05 = _mmx_add_p(prodSum03, prod45V);
    __m256 determinants = _mmx_add_p(prodSum05, Permute<1, 0, 3, 2>(prodSum05));
    __m256 determinantsSL = Permute2F128<1, 0>(determinants);
    __m256 determinants0123 = Blend<0, 1, 0, 1, 1, 0, 1, 0>(determinants, determinantsSL);
    __m256 result = _mmx_div_p(determinants0123, detA);

    return Vec4fSSE<true>(_mm256_castps256_ps128(result));
}
\end{minted}

% ------------------------------------------------------------------------------

\section{Dense Gaussian elimination}

\subsection{Theory}

\subsubsection{Standard algorithm (no pivoting)}
The standard Gaussian elimination algorithm brings the matrix representation of the system that should be solved into upper triangle form:


\begin{align}
\label{eq:gauss3x3upperTriangle}
\begin{bmatrix}
a_{00}&a_{01}&a_{02}\\
0&a_{11}&a_{12}\\
0&0&a_{22}\\
\end{bmatrix}
\cdot
\begin{bmatrix}
x_0\\
x_1\\
x_2\\
\end{bmatrix}
=
\begin{bmatrix}
b_0\\
b_1\\
b_2\\
\end{bmatrix}
\end{align}

In this form, simple backward substitution can be used to determine all unknown values $x_0$, $x_1$ and $x_2$.
The procedure to determine the upper triangular form will be illustrated on a short example.
Consider the following system:

\begin{align}
\label{eq:gauss3x3unmodified}
\begin{bmatrix}
	2&4&8\\
	1&1&1\\
	3&4&5\\
\end{bmatrix}
\cdot
\begin{bmatrix}
x_0\\
x_1\\
x_2\\
\end{bmatrix}
=
\begin{bmatrix}
2\\
1\\
2\\
\end{bmatrix}
\end{align}

Its solution is:

\begin{align*}
\begin{bmatrix}
	x_0\\
	x_1\\
	x_2\\
\end{bmatrix}
=
\begin{bmatrix}
	3\\
	-3\\
	1\\
\end{bmatrix}
\end{align*}


Multiplying individual rows with a scalar and subtracting a multiple of a row from another one does not affect the system's solution.
Note, that not only the matrix must be modified by the chosen operation, but also the right hand side vector.


This can be used to modify the matrix in a way, that all values of the first column, except the first one, become zero.
In the system of \cref{eq:gauss3x3unmodified}, this can be achieved by multiplying the first row with $\frac{1}{2}$ and subtracting the result from the second one.
The same thing is done for the third row but with a factor of $\frac{3}{2}$.
Notice that the factors are calculated by dividing the first value of a row by the first element of the first row, which is also the first value of the main diagonal.
This yields:

\begin{align*}
\begin{bmatrix}
	 \textcolor{red}{2}
	&\textcolor{red}{4}
	&\textcolor{red}{8}\\
	 \left(1 - \textcolor{blue}{\frac{1}{2}} \cdot \textcolor{red}{2}\right)
	&\left(1 - \textcolor{blue}{\frac{1}{2}} \cdot \textcolor{red}{4}\right)
	&\left(1 - \textcolor{blue}{\frac{1}{2}} \cdot \textcolor{red}{8}\right)\\
	 \left(3 - \textcolor{blue}{\frac{3}{2}} \cdot \textcolor{red}{2}\right)
	&\left(4 - \textcolor{blue}{\frac{3}{2}} \cdot \textcolor{red}{4}\right)
	&\left(5 - \textcolor{blue}{\frac{3}{2}} \cdot \textcolor{red}{8}\right)\\
\end{bmatrix}
&\cdot
\begin{bmatrix}
x_0\\
x_1\\
x_2\\
\end{bmatrix}
=
\begin{bmatrix}
\textcolor{red}{2}\\
\left(1 - \textcolor{blue}{\frac{1}{2}} \cdot \textcolor{red}{2}\right)\\
\left(2 - \textcolor{blue}{\frac{3}{2}} \cdot \textcolor{red}{2}\right)\\
\end{bmatrix}
\\
\begin{bmatrix}
2&4&8\\
0&-1&-3\\
0&-2&-7\\
\end{bmatrix}
&\cdot
\begin{bmatrix}
x_0\\
x_1\\
x_2\\
\end{bmatrix}
=
\begin{bmatrix}
2\\
0\\
-1\\
\end{bmatrix}
\end{align*}

The upper diagonal form can now be obtained by repeating this procedure for the subsystem that remains if the rows and columns above and to the left of the second value of the main diagonal are ignored.

\begin{align*}
\begin{bmatrix}
	2&
	4&
	8\\
	0&
	-1&
	-3\\
	\left(0 - \textcolor{blue}{\frac{-2}{-1}} \cdot \textcolor{red}{0} \right)&
	\left(-2 - \textcolor{blue}{\frac{-2}{-1}} \cdot \textcolor{red}{-1} \right)&
	\left(-7 - \textcolor{blue}{\frac{-2}{-1}} \cdot \textcolor{red}{-3} \right)\\
\end{bmatrix}
&\cdot
\begin{bmatrix}
	x_0\\
	x_1\\
	x_2\\
\end{bmatrix}
=
\begin{bmatrix}
	2\\
	0\\
	\left(-1 - \textcolor{blue}{\frac{-2}{-1}} \cdot \textcolor{red}{0} \right)\\
\end{bmatrix}
\\
\begin{bmatrix}
2&4&8\\
0&-1&-3\\
0&0&-1\\
\end{bmatrix}
&\cdot
\begin{bmatrix}
x_0\\
x_1\\
x_2\\
\end{bmatrix}
=
\begin{bmatrix}
2\\
0\\
-1\\
\end{bmatrix}
\end{align*}

If the matrix is larger than in the example, the algorithm would continue with the subsystem that remains after removing the columns and rows  above and to the left of the third main diagonal value and so on until the upper triangular form is achieved.

Now the unknown values can be determined by backward substitution.
The value of $x_2$ follows from the last row: 


\begin{align*}
 x_2 = 1
\end{align*}

The second row yields:

\begin{align*}
-1x_1 - 3x_2 &= 0\\
x_1 &= -3x_2\\
x_1 &= -3
\end{align*}

The first row gives:
\begin{align*}
2x_0 + 4x_1 + 8x_2 &= 2\\
2x_0  &= 2 -  4x_1 - 8x_2\\
x_0  &= 1 -  2x_1 - 4x_2 \\
x_0  &= 1 -  \left(2\cdot-3\right) - \left(4\cdot 1\right) \\
x_0  &= 3
\end{align*}

\subsubsection{Gauss-Jordan algorithm}

The Gauss-Jordan algorithm works quite similar to the standard algorithm shown in the previous section.
The major difference is, that instead of an upper triangular matrix, it produces a diagonal matrix.
This makes the backward substitution step obsolete.
The first step is identical in both algorithms, but in the second step, the first row is not ignored:

\begin{align*}
\begin{bmatrix}
\left(2 - \textcolor{blue}{\frac{4}{-1}} \cdot \textcolor{red}{0} \right)&
\left(4 - \textcolor{blue}{\frac{4}{-1}} \cdot \textcolor{red}{-1} \right)&
\left(8 - \textcolor{blue}{\frac{4}{-1}} \cdot \textcolor{red}{-3} \right)\\
0&
-1&
-3\\
\left(0 - \textcolor{blue}{\frac{-2}{-1}} \cdot \textcolor{red}{0} \right)&
\left(-2 - \textcolor{blue}{\frac{-2}{-1}} \cdot \textcolor{red}{-1} \right)&
\left(-7 - \textcolor{blue}{\frac{-2}{-1}} \cdot \textcolor{red}{-3} \right)\\
\end{bmatrix}
&\cdot
\begin{bmatrix}
x_0\\
x_1\\
x_2\\
\end{bmatrix}
=
\begin{bmatrix}
\left(2 - \textcolor{blue}{\frac{4}{-1}} \cdot \textcolor{red}{0} \right)\\
0\\
\left(-1 - \textcolor{blue}{\frac{-2}{-1}} \cdot \textcolor{red}{0} \right)\\
\end{bmatrix}
\\
\begin{bmatrix}
2&0&-4\\
0&-1&-3\\
0&0&-1\\
\end{bmatrix}
&\cdot
\begin{bmatrix}
x_0\\
x_1\\
x_2\\
\end{bmatrix}
=
\begin{bmatrix}
2\\
0\\
-1\\
\end{bmatrix}
\end{align*}

In contrast to the general algorithm, an extra step at the end is needed to get the diagonal form.
The procedure remains the same with the only difference to previous steps being the fact that there is no more row below the pivot element:

\begin{align*}
\begin{bmatrix}
\left(2 - \textcolor{blue}{\frac{-4}{-1}} \cdot \textcolor{red}{0} \right)&
\left(0 - \textcolor{blue}{\frac{-4}{-1}} \cdot \textcolor{red}{0} \right)&
\left(-4 - \textcolor{blue}{\frac{-4}{-1}} \cdot \textcolor{red}{-1} \right)\\
\left(0 - \textcolor{blue}{\frac{-3}{-1}} \cdot \textcolor{red}{0} \right)&
\left(-1 - \textcolor{blue}{\frac{-3}{-1}} \cdot \textcolor{red}{0} \right)&
\left(-3 - \textcolor{blue}{\frac{-3}{-1}} \cdot \textcolor{red}{-1} \right)\\
0&
0&
-1\\
\end{bmatrix}
&\cdot
\begin{bmatrix}
x_0\\
x_1\\
x_2\\
\end{bmatrix}
=
\begin{bmatrix}
\left(2 - \textcolor{blue}{\frac{-4}{-1}} \cdot \textcolor{red}{-1} \right)\\
\left(0 - \textcolor{blue}{\frac{-3}{-1}} \cdot \textcolor{red}{-1} \right)\\
-1\\
\end{bmatrix}
\\
\begin{bmatrix}
2&0&0\\
0&-1&0\\
0&0&-1\\
\end{bmatrix}
&\cdot
\begin{bmatrix}
x_0\\
x_1\\
x_2\\
\end{bmatrix}
=
\begin{bmatrix}
6\\
3\\
-1\\
\end{bmatrix}
\end{align*}

If the right hand side values are divided by the corresponding matrix main diagonal value, the same result as in the previous section is obtained.


\subsubsection{Pivoting}


\subsection{Optimizations}

\subsection{Implementation}
\subsubsection{Serial version}
\subsubsection{Vectorized version}

\section{LU decomposition}

\section{Cholesky decomposition}



\end{document}
